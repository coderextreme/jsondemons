<!-- client/1main.html -->
<head>
  <title>JSON Demons-tration (High-Performance)</title>
  <link rel='stylesheet' type='text/css' href='https://www.x3dom.org/download/x3dom.css'>
  <script src="https://andreasplesch.github.io/x3dom/dist/x3dom-full.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
</head>

<body>
  {{> buttons }}
  {{> myCanvas }}
</body>

<template name="buttons">
  <div id="menu">
    <span>
      <input name="tools" type="radio" id="drag" checked><span class="webfont">Move&lt;--</span>
      <input name="tools" type="radio" id="makeJSON"><span class="webfont">Add+</span>
      <input name="tools" type="radio" id="delete"><span class="webfont">Subtract-</span>
      <input name="tools" type="radio" id="input"><span class="webfont">+Input</span>
      <input name="tools" type="radio" id="output"><span class="webfont">Output+</span>
      <input name="tools" type="radio" id="relationship"><span class="webfont">Connect&gt;&lt;</span>
      <input name="tools" type="radio" id="editJSON"><span class="webfont">Edit/</span>
      <input name="tools" type="radio" id="saveJSON"><span class="webfont">Save[V]</span>
      <input name="tools" type="radio" id="loadJSON"><span class="webfont">Load[^]</span>
      <input name="tools" type="radio" id="resetJSON"><span class="webfont">Reset</span>
      <input name="tools" type="radio" id="sequenceJSON"><span class="webfont">Record o_o</span>
      <input type="file" id="file-input" accept="text/json" style="display: none;">
    </span>
  </div>
</template>

<template name="json">
  <Transform id="T_{{_id}}" DEF="T_{{_id}}" translation="{{x}} {{y}} {{z}}">
    <PlaneSensor DEF="PS_{{_id}}" enabled="{{isDraggable}}" offset="{{x}} {{y}} {{z}}"></PlaneSensor>
    <Shape onclick="X3DOM_Events.handleClick('json', '{{_id}}')">
      <Box size="20 30 0.5"></Box>
      <Appearance><Material diffuseColor="0.5 0.5 0.5"></Material></Appearance>
    </Shape>
    <Transform translation="0 14 1">
      <Shape><Appearance><Material diffuseColor='0 0 0'></Material></Appearance><Text string='"{{title}}"'><FontStyle family="'Orbitron'" style="bold" size="1"></FontStyle></Text></Shape>
    </Transform>
    <Transform translation="0 0 1">
      <Shape><Appearance><Material diffuseColor='1 0 1'></Material></Appearance><Text string='{{data}}'><FontStyle family="'Orbitron'" style="bold" size="4"></FontStyle></Text></Shape>
    </Transform>
  </Transform>
  <!-- The ROUTE connects the sensor to the transform for smooth dragging -->
  <ROUTE fromNode="PS_{{_id}}" fromField="translation_changed" toNode="T_{{_id}}" toField="set_translation"></ROUTE>
</template>

<template name="port">
  <Transform id="T_{{_id}}" DEF="T_{{_id}}" translation="{{x}} {{y}} {{z}}">
    <PlaneSensor DEF="PS_{{_id}}" enabled="{{isDraggable}}" offset="{{x}} {{y}} {{z}}"></PlaneSensor>
    <Shape onclick="X3DOM_Events.handleClick('port', '{{_id}}')">
      <Box size="2 2 2"></Box>
      <Appearance><Material diffuseColor="{{color}}"></Material></Appearance>
    </Shape>
  </Transform>
  <ROUTE fromNode="PS_{{_id}}" fromField="translation_changed" toNode="T_{{_id}}" toField="set_translation"></ROUTE>
</template>

<template name="line">
    <Transform translation="0 0 0">
            <Shape>
          <Appearance>
	    <LineProperties linewidthScaleFactor='20'></LineProperties>
            <Material diffuseColor='1 0 0'></Material>
          </Appearance>
          <LineSet DEF='Geometry_1' vertexCount='3'>
            <Coordinate point='{{x1}} {{y1}} {{z1}}, {{x2}} {{y2}} {{z2}}, {{x3}} {{y3}} {{z3}}'></Coordinate>
          </LineSet>
        </Shape>
    </Transform>
</template>

<template name="myCanvas">
  <div class="myCanvas draggableContainer" id="container">
    <x3d id="x3dElement" height="900px" width="100%">
      <scene>
        <Viewpoint position='0 0 100'></Viewpoint>
        <NavigationInfo id="navInfo" type='"EXAMINE" "ANY"'></NavigationInfo>
        {{#each jsons}} {{> json }} {{/each}}
        {{#each ports}} {{> port }} {{/each}}
        {{#each lines}} {{> line }} {{/each}}
      </scene>
    </x3d>
  </div>
</template>
